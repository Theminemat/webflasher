<!DOCTYPE html>
<html>
<body>
    <div id="main" style="display: none;">
        <h1>ESP-Web-Tool-Test</h1>
        <script type="module" src="https://unpkg.com/esp-web-tools@3.4.2/dist/web/install-button.js?module"></script>
        <esp-web-install-button manifest="test/manifest.json"></esp-web-install-button>
        <div id="notSupported" style="display: none;">
            Your browser does not support the Web Serial API. Try Chrome
        </div>
    </div>
    <script>
        if (navigator.serial) {
            document.getElementById("notSupported").style.display = 'none';
            document.getElementById("main").style.display = 'block';

            // Funktion zum Überprüfen des Fehlers und Weiterleiten
            function checkForError() {
                const installButton = document.querySelector('esp-web-install-button');
                if (installButton && installButton.shadowRoot) {
                    const flashProgress = installButton.shadowRoot.querySelector('esp-web-flash-progress');
                    if (flashProgress && flashProgress.shadowRoot) {
                        const errorElement = flashProgress.shadowRoot.querySelector('h2.error');
                        if (errorElement && errorElement.textContent.includes("Didn't get enough status bytes")) {
                            window.location.href = 'https://tools.theminemat.de/error?mode=success&title=Installation+was+successful%21&message=You+have+successfully+installed+the+software.+You+may+need+to+restart+your+device.&animation=1&textanimation=2';
                        }
                    }
                }
            }

            // Überprüfen Sie den Fehler in regelmäßigen Abständen
            setInterval(checkForError, 600);
        } else {
            document.getElementById("notSupported").style.display = 'block';
            document.getElementById("main").style.display = 'none';
        }
    </script>
</body>
</html>
